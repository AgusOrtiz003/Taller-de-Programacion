programa p4p1
procesos
  proceso confirmarEntrega(E id:numero)
  comenzar
    si(id=1)
      EnviarMensaje(V,r1)
    sino
      si(id=2)
        EnviarMensaje(V,r2)
      sino
        EnviarMensaje(V,r3)
  fin
areas
  area1:AreaPC(1,1,1,100)
  area2:AreaPC(2,1,2,100)
  area3:AreaPC(3,1,3,100)
  areaS:AreaP(100,100,100,100)
robots
  robot Cliente
  variables
    id,f,av,ca:numero
    ok:boolean
  comenzar
    RecibirMensaje(id,s)
    mientras(PosCa<100)
      av:=PosAv
      ca:=PosCa
      Random(f,1,4)
      EnviarMensaje(id,s)
      EnviarMensaje(f,s)
      EnviarMensaje(av,s)
      EnviarMensaje((ca+1),s)
      RecibirMensaje(ok,s)
      mover
      mientras(HayFlorEnLaEsquina)
        tomarFlor
      Pos(PosAv,PosCa-1)
      mientras((HayFlorEnLaBolsa)&(PosCa<100))
        depositarFlor
        mover
    EnviarMensaje(id,s)
    EnviarMensaje(0,s)
    Informar('Termine',id)
  fin
  robot Servidor
  variables
    id,f,av,ca,ceros:numero
  comenzar
    f:=-1
    ceros:=0
    EnviarMensaje(1,r1)
    EnviarMensaje(2,r2)
    EnviarMensaje(3,r3)
    mientras(ceros<3)
      RecibirMensaje(id,*)
      si(id=1)
        RecibirMensaje(f,r1)
      sino
        si(id=2)
          RecibirMensaje(f,r2)
        sino
          RecibirMensaje(f,r3)
      si(f>0)
        si(id=1)
          RecibirMensaje(av,r1)
          RecibirMensaje(ca,r1)
        sino
          si(id=2)
            RecibirMensaje(av,r2)
            RecibirMensaje(ca,r2)
          sino
            RecibirMensaje(av,r3)
            RecibirMensaje(ca,r3)
        Pos(av,ca)
        repetir f
          depositarFlor
        Pos(100,100)
        confirmarEntrega(id)
      sino
        ceros:=ceros+1
  fin
variables
  r1,r2,r3:Cliente
  s:Servidor
comenzar
  AsignarArea(r1,area1)
  AsignarArea(r2,area2)
  AsignarArea(r3,area3)
  AsignarArea(s,area1)
  AsignarArea(s,area2)
  AsignarArea(s,area3)
  AsignarArea(s,areaS)
  Iniciar(r1,1,1)
  Iniciar(r2,2,1)
  Iniciar(r3,3,1)
  Iniciar(s,100,100)  
fin
